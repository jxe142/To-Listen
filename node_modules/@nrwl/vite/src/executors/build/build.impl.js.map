{"version":3,"sources":["../../../../../../packages/vite/src/executors/build/build.impl.ts"],"sourcesContent":["import 'dotenv/config';\nimport { ExecutorContext, logger } from '@nrwl/devkit';\nimport { build, InlineConfig } from 'vite';\nimport { getBuildAndSharedConfig } from '../../utils/options-utils';\nimport { ViteBuildExecutorOptions } from './schema';\nimport { copyAssets } from '@nrwl/js';\nimport { existsSync } from 'fs';\nimport { resolve } from 'path';\n\nexport default async function viteBuildExecutor(\n  options: ViteBuildExecutorOptions,\n  context: ExecutorContext\n) {\n  const projectRoot = context.workspace.projects[context.projectName].root;\n\n  await runInstance(await getBuildAndSharedConfig(options, context));\n\n  const libraryPackageJson = resolve(projectRoot, 'package.json');\n  const rootPackageJson = resolve(context.root, 'package.json');\n\n  // For buildable libs, copy package.json if it exists.\n  if (\n    existsSync(libraryPackageJson) &&\n    rootPackageJson !== libraryPackageJson\n  ) {\n    await copyAssets(\n      {\n        outputPath: options.outputPath,\n        assets: [\n          {\n            input: projectRoot,\n            output: '.',\n            glob: 'package.json',\n          },\n        ],\n      },\n      context\n    );\n  }\n\n  return { success: true };\n}\n\nfunction runInstance(options: InlineConfig) {\n  return build({\n    ...options,\n  });\n}\n"],"names":["viteBuildExecutor","options","context","projectRoot","workspace","projects","projectName","root","runInstance","getBuildAndSharedConfig","libraryPackageJson","resolve","rootPackageJson","existsSync","copyAssets","outputPath","assets","input","output","glob","success","build"],"mappings":"AAAA;+BASA;;aAA8BA;;;QATvB;sBAE6B;8BACI;oBAEb;oBACA;sBACH;AAET,eAAeA,kBAC5BC,OAAiC,EACjCC,OAAwB,EACxB;IACA,MAAMC,cAAcD,QAAQE,SAAS,CAACC,QAAQ,CAACH,QAAQI,WAAW,CAAC,CAACC,IAAI;IAExE,MAAMC,YAAY,MAAMC,IAAAA,qCAAuB,EAACR,SAASC;IAEzD,MAAMQ,qBAAqBC,IAAAA,aAAO,EAACR,aAAa;IAChD,MAAMS,kBAAkBD,IAAAA,aAAO,EAACT,QAAQK,IAAI,EAAE;IAE9C,sDAAsD;IACtD,IACEM,IAAAA,cAAU,EAACH,uBACXE,oBAAoBF,oBACpB;QACA,MAAMI,IAAAA,cAAU,EACd;YACEC,YAAYd,QAAQc,UAAU;YAC9BC,QAAQ;gBACN;oBACEC,OAAOd;oBACPe,QAAQ;oBACRC,MAAM;gBACR;aACD;QACH,GACAjB;IAEJ,CAAC;IAED,OAAO;QAAEkB,SAAS,IAAI;IAAC;AACzB;AAEA,SAASZ,YAAYP,OAAqB,EAAE;IAC1C,OAAOoB,IAAAA,WAAK,EAAC,aACRpB;AAEP"}